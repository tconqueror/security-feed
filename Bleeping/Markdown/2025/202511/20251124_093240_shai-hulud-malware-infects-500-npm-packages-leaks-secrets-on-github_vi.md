# Shai-Hulud malware infects 500 npm packages, leaks secrets on GitHub

![Shai-Hulud malware infects 500 npm packages, leaks secrets on GitHub](https://www.bleepstatic.com/content/hl-images/2022/07/05/NPM_head_pic.jpg)

Hàng trăm phiên bản trojan hóa của các package nổi tiếng như Zapier, ENS Domains, PostHog và Postman đã bị cấy vào registry npm trong một chiến dịch chuỗi cung ứng mới của Shai-Hulud.

Các package độc hại đã được thêm vào NPM (Node Package Manager) trong suốt cuối tuần nhằm đánh cắp bí mật của nhà phát triển và bí mật trong quy trình CI/CD (continuous integration and continuous delivery). Dữ liệu sau đó được tự động đăng lên GitHub ở dạng được mã hóa.

Tại thời điểm bài viết, GitHub trả về 27.600 kết quả tương ứng với các mục liên quan đến vụ tấn công gần đây.

[![Wiz](https://www.bleepstatic.com/c/w/wiz/Securing-AI-Agents-970x250.png)](https://www.wiz.io/lp/securing-ai-agents-101?utm%5Fsource=bleepingcomputer&utm%5Fmedium=display&utm%5Fcampaign=FY26Q3%5FINB%5FFORM%5FSecuring-AI-Agents-101&sfcid=701Py00000RTEWMIA5&utm%5Fterm=FY26Q4-bleepingcomputer-970x250&utm%5Fcontent=AIAgents101) 

![GitHub repositories with secrets stolen in the new Shai-Hulud campaign](https://www.bleepstatic.com/images/news/u/1100723/Shai-Hulud_npm_27k.jpg)

**Các repository GitHub chứa bí mật bị đánh cắp trong chiến dịch Shai-Hulud mới**  
_source: BleepingComputer_

Khi malware Shai-Hulud lần đầu xuất hiện trong không gian npm vào giữa tháng Chín, nó đã [xâm phạm 187 package](https://www.bleepingcomputer.com/news/security/self-propagating-supply-chain-attack-hits-187-npm-packages/) với một payload tự lây lan sử dụng công cụ TruffleHog để đánh cắp bí mật của nhà phát triển.

Tác nhân đe dọa tự động tải xuống các package hợp lệ, sửa đổi file _package.json_ để chèn một script độc hại, rồi xuất bản chúng trên npm bằng các tài khoản maintainer bị xâm nhập.

Khi Charlie Eriksen, nhà nghiên cứu malware tại nền tảng bảo mật dành cho nhà phát triển Aikido Security, phát hiện [chiến dịch mới](https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains) vào sáng nay, có 105 package trojan hóa có các chỉ báo của Shai-Hulud. Kể từ đó, con số đã tăng lên 492, một số trong đó có nhiều phiên bản.

Sau đó, nhà nghiên cứu đã [cảnh báo](https://www.linkedin.com/posts/charlie-eriksen-a318578%5Fshai-hulud-is-again-leaking-secrets-in-public-activity-7398643346665066496-6PAn/?utm%5Fsource=social%5Fshare%5Fsend&utm%5Fmedium=member%5Fdesktop%5Fweb&rcm=ACoAADF0KC4BTJGz8kWN83W1dLn57SAB7Kxkidc) rằng các bí mật bị đánh cắp trong cuộc tấn công chuỗi cung ứng đã bị rò rỉ trên GitHub.

Tuy nhiên, chiến dịch đã phát triển theo cấp số nhân lên hơn 27.000 package độc hại. Các nhà nghiên cứu mối đe dọa tại nền tảng bảo mật đám mây Wiz phát hiện khoảng 350 tài khoản maintainer duy nhất được sử dụng trong chiến dịch, [ghi nhận](https://www.wiz.io/blog/shai-hulud-2-0-ongoing-supply-chain-attack) rằng "1.000 repository mới đang được thêm liên tục mỗi 30 phút trong vài giờ gần đây."

Eriksen làm rõ với BleepingComputer rằng các repository trên GitHub cho thấy những nhà phát triển bị xâm nhập đã sử dụng các package npm trojan hóa và có thông tin đăng nhập GitHub trên môi trường của họ.

Một [phân tích kỹ thuật](https://www.stepsecurity.io/blog/sha1-hulud-the-second-coming-zapier-ens-domains-and-other-prominent-npm-packages-compromised) của malware Shai-Hulud mới từ công ty bảo mật CI/CD Step Security giải thích rằng các payload mới xuất hiện trong hai file, một file là _setup_bun.js_ — một dropper cải trang thành trình cài Bun.

File thứ hai có tên _bun_environment.js_ và có kích thước lớn khoảng 10MB. Nó dựa vào "các kỹ thuật obfuscation cực đoan", Step Security cho biết, chẳng hạn như một chuỗi hex được mã hóa lớn với hàng ngàn mục, một vòng lặp chống phân tích, và một hàm bị obfuscate để truy xuất mọi chuỗi trong mã.

Theo Wiz, mã độc thu thập bí mật của nhà phát triển và CI/CD rồi xuất bản chúng lên các repository GitHub "với tên tham chiếu tới Shai-Hulud." Mã độc chỉ thực thi trong giai đoạn pre-install và tạo ra các file sau:

* cloud.json
* contents.json
* environment.json
* truffleSecrets.json

Các bí mật bị đánh cắp được xuất bản trên GitHub vào các repository được tạo tự động có mô tả "Sha1-Hulud: The Second Coming."

Có vẻ như tác nhân đe dọa cũng đã truy cập được các tài khoản GitHub mà họ đang dùng để tạo các repository chứa bốn file trên.

**Các tài khoản GitHub đang host repo từ chiến dịch Shai-Hulud**  
_source: BleepingComputer_

GitHub đang xóa các repository của kẻ tấn công khi chúng xuất hiện, nhưng kẻ tấn công dường như đang tạo các repository mới rất nhanh.

Trong danh sách 186 package mà Aikido Security phát hiện bị xâm phạm với một phiên bản mới của malware Shai Hulud, có nhiều package từ Zapier, ENS Domains, PostHog, và AsyncAPI.

Các package Zapier bị xâm phạm tạo thành toolkit chính thức để xây dựng các tích hợp Zapier và rất quan trọng đối với các nhà phát triển Zapier.

Các package EnsDomains là các công cụ và thư viện được sử dụng rộng rãi bởi ví, DApps, sàn giao dịch, và ứng dụng ENS Manager, để xử lý tên .eth, phân giải chúng tới địa chỉ Ethereum, liên kết nội dung IPFS, xác thực tên, và tương tác với các smart contract ENS chính thức.

Tất cả các package bị xâm phạm đều có sẵn để tải xuống từ npm. Tuy nhiên, trong một vài trường hợp, nền tảng hiển thị thông báo cảnh báo về việc xuất bản phiên bản mới không được ủy quyền, cho thấy việc rà soát tự động đã phát hiện dấu hiệu bị xâm phạm.

**Thông báo cảnh báo trên npm**  
_Source: BleepingComputer_

Các nhà phát triển được khuyên kiểm tra bài đăng của Aikido để xem danh sách đầy đủ các package bị nhiễm, hạ cấp về các phiên bản an toàn, và xoay vòng (rotate) các bí mật và token CI/CD ngay lập tức.

Các nhà nghiên cứu của Wiz khuyến nghị các nhóm bảo mật trước tiên xác định các package bị xâm phạm và thay thế chúng bằng các package hợp lệ. Họ cũng thúc giục các tổ chức xoay vòng tất cả các thông tin xác thực liên quan tới npm, GitHub, và nhà cung cấp đám mây.

Aikido Security khuyên các nhà phát triển vô hiệu hóa các script postinstall của npm trong quá trình continuous integration, nếu có thể.

Sự trở lại của Shai Hulud diễn ra vào thời điểm GitHub [giới thiệu các biện pháp an ninh bổ sung](https://www.bleepingcomputer.com/news/security/github-tightens-npm-security-with-mandatory-2fa-access-tokens/) để ngăn chặn các cuộc tấn công chuỗi cung ứng trên npm, sau một loạt các vụ tấn công có tác động cao trên nền tảng. Tuy nhiên, các biện pháp đang được triển khai dần dần.