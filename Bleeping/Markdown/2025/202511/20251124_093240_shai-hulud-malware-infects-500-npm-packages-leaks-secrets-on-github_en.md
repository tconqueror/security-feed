# Shai-Hulud malware infects 500 npm packages, leaks secrets on GitHub

![Shai-Hulud malware infects 500 npm packages, leaks secrets on GitHub](https://www.bleepstatic.com/content/hl-images/2022/07/05/NPM_head_pic.jpg)

Hundreds of trojanized versions of well-known packages such as Zapier, ENS Domains, PostHog, and Postman have been planted in the npm registry in a new Shai-Hulud supply-chain campaign.

The malicious packages have been added to NPM (Node Package Manager) over the weekend to steal developer and continuous integration and continuous delivery (CI/CD) secrets. The data is automatically posted on GitHub in encoded form. 

At publishing time, GitHub returned 27,600 results corresponding to entries related to the recent attack.

[![Wiz](https://www.bleepstatic.com/c/w/wiz/Securing-AI-Agents-970x250.png)](https://www.wiz.io/lp/securing-ai-agents-101?utm%5Fsource=bleepingcomputer&utm%5Fmedium=display&utm%5Fcampaign=FY26Q3%5FINB%5FFORM%5FSecuring-AI-Agents-101&sfcid=701Py00000RTEWMIA5&utm%5Fterm=FY26Q4-bleepingcomputer-970x250&utm%5Fcontent=AIAgents101) 

![GitHub repositories with secrets stolen in the new Shai-Hulud campaign](https://www.bleepstatic.com/images/news/u/1100723/Shai-Hulud_npm_27k.jpg)

**GitHub repositories with secrets stolen in the new Shai-Hulud campaign**  
_source: BleepingComputer_

When the Shai-Hulud malware first appeared in the npm space in mid-September, and it [compromised 187 packages](https://www.bleepingcomputer.com/news/security/self-propagating-supply-chain-attack-hits-187-npm-packages/) with a self-propagating payload that used the TruffleHog tool to steal developer secrets.

The threat actor automatically downloaded legitimate packages, modified the _package.json_ file to inject a malicious script, and then published them on npm using compromised maintainer accounts.

When Charlie Eriksen, malware researcher at developer-focused security platform Aikido Security, discovered the [new campaign](https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains) earlier today, there were 105 trojanized packages with Shai-Hulud indicators. Since then, the number grew to 492, some of them with multiple versions.

Later, the researcher [warned](https://www.linkedin.com/posts/charlie-eriksen-a318578%5Fshai-hulud-is-again-leaking-secrets-in-public-activity-7398643346665066496-6PAn/?utm%5Fsource=social%5Fshare%5Fsend&utm%5Fmedium=member%5Fdesktop%5Fweb&rcm=ACoAADF0KC4BTJGz8kWN83W1dLn57SAB7Kxkidc) that the secrets stolen in the supply-chain attack were leaked on GitHub.

However, the campaign has grown exponentially to more than 27,000 malicious packages. Threat researchers at Wiz cloud security platform discovered around 350 unique maintainer accounts used in the campaign, [noting](https://www.wiz.io/blog/shai-hulud-2-0-ongoing-supply-chain-attack) that " 1,000 new repositories are being added consistently every 30 minutes in the last couple of hours."

Eriksen clarified for BleepingComputer that the repositories on GitHub are indicative of compromised developers that used trojanized npm packages and thad GitHub credentials on their environment.

A [technical analysis](https://www.stepsecurity.io/blog/sha1-hulud-the-second-coming-zapier-ens-domains-and-other-prominent-npm-packages-compromised) of the new Shai-Hulud malware analysis from CI/CD security company Step Security explains that the new payloads are present in two files, one being _setup\_bun.js_ \- a dropper disguised as a Bun installer.

The second file is called _bun\_environment.js_ and is sizeable at 10MB. It relies on "extreme obfuscation techniques," Step Security says, such as a large hex-encoded string with thousands of entries, an anti-analysis loop, and an obfuscated function to retrieve every string in the code.

According to Wiz, the malicious code collects developer and CI/CD secrets and publishes them to GitHub repositories "with names referencing Shai-Hulud." The malicious code executes only during the pre-install stage and creates the following files:

* cloud.json
* contents.json
* environment.json
* truffleSecrets.json

Stolen secrets are published on GitHub to automatically-generated repositories that have the description "Sha1-Hulud: The Second Coming."

It appears that the threat actor has also gained access to GitHub accounts that they are now using to create repositories with the four files above.

**GitHub accounts hosting repos from the Shai-Hulud campaign**  
_source: BleepingComputer_

GitHub is deleting the attacker’s repositories as they emerge, but the threat actor appears to be creating new ones very fast.

On the list of 186 packages that Aikido Security found to be compromised with a new version of the Shai Hulud malware, there are multiple packages from Zapier, ENS Domains, PostHog, and AsyncAPI.

The compromised Zapier packages constitute the official toolkit for building Zapier integrations and are essential for Zapier developers.

The EnsDomains packages are tools and libraries widely used by wallets, DApps, exchanges, and the ENS Manager app, to handle .eth names, resolving them to Ethereum addresses, linking IPFS content, validating names, and interacting with the official ENS smart contracts.

All of the compromised packages are available for download from npm. However, in some cases, the platform displays a warning message about unauthorized publication of the latest version, indicating that the automated review has caught signs of a compromise.

**Warning message on npm**  
_Source: BleepingComputer_

Developers are advised to check Aikido’s post for the complete list of the infected packages, downgrade to safe versions, and rotate their secrets and CI/CD tokens immediately.

Wiz researchers recommend security teams to first identify the compromised packages and replace them with legitimate ones. They also urge organizations to rotate all credentials tied to npm, GitHub, and cloud providers.

Aikido Security advises developers to disable npm postinstall scripts during continuous integration, if possible.

The return of Shai Hulud comes at a time when GitHub [introduced additional security measures](https://www.bleepingcomputer.com/news/security/github-tightens-npm-security-with-mandatory-2fa-access-tokens/) to prevent supply-chain attacks on npm, following a series of high-impact attacks on the platform. However, the measures are being implemented gradually.