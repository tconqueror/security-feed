# Tin tặc nhà nước Trung Quốc sử dụng rootkit để che giấu hoạt động phần mềm độc hại ToneShell

![Tin tặc nhà nước Trung Quốc sử dụng rootkit để che giấu hoạt động phần mềm độc hại ToneShell](https://www.bleepstatic.com/content/hl-images/2025/09/30/Panda_Bear_Storm.jpg)

Một mẫu mới của backdoor ToneShell, thường xuất hiện trong các chiến dịch gián điệp mạng liên quan tới Trung Quốc, đã được triển khai thông qua một trình tải chế độ hạt nhân trong các cuộc tấn công nhắm vào các tổ chức chính phủ.

Backdoor này được quy cho nhóm [Mustang Panda group](https://www.bleepingcomputer.com/news/security/chinese-hackers-abuse-microsoft-app-v-tool-to-evade-antivirus/), còn được biết đến với tên HoneyMyte hoặc Bronze President, nhóm thường nhắm mục tiêu vào [các cơ quan chính phủ](https://www.bleepingcomputer.com/news/security/chinese-hackers-use-google-drive-to-drop-malware-on-govt-networks/), các tổ chức phi chính phủ (NGOs), các viện nghiên cứu, và các tổ chức có hồ sơ cao khác trên toàn [thế giới](https://www.bleepingcomputer.com/news/security/chinese-hackers-use-new-custom-backdoor-to-evade-detection/).

Các nhà nghiên cứu bảo mật tại Kaspersky đã phân tích một file driver độc hại tìm thấy trên hệ thống máy tính ở châu Á và phát hiện rằng nó đã được sử dụng trong các chiến dịch ít nhất từ tháng 2 năm 2025 chống lại các tổ chức chính phủ ở Myanmar, Thailand và các quốc gia châu Á khác.

[![Wiz](https://www.bleepstatic.com/c/a/as-Free-Phishing-970x250.jpg)](https://www.adaptivesecurity.com/lp/nb/free-phishing-test?utm%5Fsource=display%5Fnetwork&utm%5Fmedium=paid%5Fdisplay&utm%5Fcampaign=2025%5F12%5FLinkedin%5FSocial%5FNA%5FBrand%5FAwareness%5FTeachers%5Ffunding&utm%5Fid=701Rd00000ZoWjjIAF%2F&utm%5Fcontent=970%5F250)

Bằng chứng cho thấy các thực thể bị xâm nhập đã có các nhiễm trước đó với các biến thể ToneShell cũ hơn, phần mềm độc hại PlugX, hoặc sâu USB ToneDisk, cũng được quy cho các tin tặc nhà nước Trung Quốc.

### Rootkit chế độ hạt nhân mới

Theo Kaspersky, backdoor ToneShell mới đã được triển khai bởi một mini-filter driver có tên _ProjectConfiguration.sys_ và được ký bằng một chứng chỉ bị đánh cắp hoặc rò rỉ có hiệu lực từ 2012 đến 2015, cấp cho Guangzhou Kingteller Technology Co., Ltd.

Mini-filters là các driver chế độ hạt nhân (kernel-mode) cắm vào ngăn xếp I/O hệ thống tệp của Windows và có thể kiểm tra, thay đổi hoặc chặn các thao tác tệp. Các phần mềm bảo mật, công cụ mã hóa và tiện ích sao lưu thường sử dụng chúng.

_ProjectConfiguration.sys_ nhúng hai shellcode chế độ người dùng trong phần .data của nó, mỗi cái được thực thi như một luồng chế độ người dùng riêng biệt để tiêm vào các tiến trình chế độ người dùng.

Để né tránh phân tích tĩnh, driver giải quyết các API hạt nhân cần thiết tại thời gian chạy bằng cách liệt kê các mô-đun kernel đã tải và đối chiếu băm hàm, thay vì nhập các hàm trực tiếp.

Nó đăng ký như một mini-filter driver và chặn các thao tác hệ thống tệp liên quan đến xóa và đổi tên. Khi các thao tác như vậy nhắm vào chính driver, chúng bị chặn bằng cách ép yêu cầu thất bại.

Driver cũng bảo vệ các khóa registry liên quan tới dịch vụ của nó bằng cách đăng ký một callback registry và từ chối nỗ lực tạo hoặc mở các khóa đó. Để đảm bảo ưu tiên so với các sản phẩm bảo mật, nó chọn một mini-filter altitude cao hơn phạm vi dành riêng cho antivirus.

Ngoài ra, rootkit can thiệp vào Microsoft Defender bằng cách sửa đổi cấu hình của driver WdFilter sao cho nó không được tải vào ngăn xếp I/O.

Để che chắn các payload đã bị tiêm vào chế độ người dùng, driver duy trì một danh sách ID tiến trình được bảo vệ, từ chối truy cập handle tới các tiến trình đó trong khi payload đang thực thi, và gỡ bỏ bảo vệ sau khi thực thi hoàn tất.

"Đây là lần đầu tiên chúng tôi thấy ToneShell được phân phối thông qua một loader chế độ hạt nhân, giúp nó được bảo vệ khỏi giám sát chế độ người dùng và hưởng lợi từ các khả năng rootkit của driver để che giấu hoạt động của nó khỏi các công cụ bảo mật," [theo Kaspersky](https://securelist.com/honeymyte-kernel-mode-rootkit/118590/).

![Attack overview](https://www.bleepstatic.com/images/news/u/1220909/2025/December/honeymyte-kernel3.jpg)

**Tổng quan vụ tấn công mới nhất của Mustang Panda**  
_Nguồn: Kaspersky_

### Biến thể ToneShell mới

Biến thể mới của backdoor ToneShell mà Kaspersky phân tích có những thay đổi và cải tiến ẩn mình. Phần mềm độc hại giờ sử dụng một sơ đồ định danh host mới dựa trên một 4-byte host ID thay vì GUID 16-byte được dùng trước đây, và còn áp dụng che giấu lưu lượng mạng bằng các header TLS giả.

Về các thao tác từ xa được hỗ trợ, backdoor hiện hỗ trợ các lệnh sau:

* 0x1 — Tạo một tệp tạm cho dữ liệu đến
* 0x2 / 0x3 — Tải xuống tệp
* 0x4 — Hủy tải xuống
* 0x7 — Thiết lập shell từ xa qua pipe
* 0x8 — Nhận lệnh từ operator
* 0x9 — Kết thúc shell
* 0xA / 0xB — Tải lên tệp
* 0xC — Hủy tải lên
* 0xD — Đóng kết nối

Kaspersky khuyên rằng phân tích bộ nhớ (memory forensics) là chìa khóa trong việc phát hiện các nhiễm ToneShell được hỗ trợ bởi bộ tiêm chế độ hạt nhân mới.

Các nhà nghiên cứu có mức độ tin cậy cao khi gán mẫu backdoor ToneShell mới cho nhóm gián điệp mạng Mustang Panda. Họ đánh giá rằng tác nhân đe dọa đã phát triển chiến thuật, kỹ thuật và thủ tục để đạt được khả năng ẩn mình và độ bền trong hoạt động.

Công ty an ninh mạng này cung cấp trong báo cáo một danh sách ngắn các chỉ số xâm phạm (IoCs) để giúp các tổ chức phát hiện sự xâm nhập của Mustang Panda và phòng thủ chống lại chúng.