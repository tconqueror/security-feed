# Lỗ hổng zero-day trong Microsoft SharePoint bị khai thác trong các cuộc tấn công RCE, chưa có bản vá

![SharePoint](https://www.bleepstatic.com/content/hl-images/2025/07/20/sharepoint-small-red-flare.jpg)

Một lỗ hổng zero-day nghiêm trọng trong Microsoft SharePoint, được theo dõi là CVE-2025-53770, đã bị khai thác tích cực từ ít nhất ngày 18 tháng 7, với không có bản vá nào và ít nhất 85 máy chủ đã bị xâm phạm trên toàn cầu.

Vào tháng 5, các nhà nghiên cứu bảo mật mạng Viettel đã kết hợp hai lỗ hổng trong Microsoft SharePoint, [CVE-2025-49706](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49706) và [CVE-2025-49704](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49704), trong một cuộc tấn công "ToolShell" được trình diễn tại Pwn2Own Berlin để đạt được việc thực thi mã từ xa.

Trong khi Microsoft đã vá cả hai lỗ hổng ToolShell trong [Patch Tuesday tháng 7](https://www.bleepingcomputer.com/news/microsoft/microsoft-july-2025-patch-tuesday-fixes-one-zero-day-137-flaws/), hiện tại Microsoft đang cảnh báo rằng một biến thể của CVE-2025-49706, được theo dõi là [CVE-2025-53770](http://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770), đang bị khai thác tích cực trên thực tế.

"Microsoft nhận thức được các cuộc tấn công đang diễn ra nhắm vào khách hàng của máy chủ SharePoint tại chỗ," [cảnh báo Microsoft](https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/).

"Các cuộc tấn công đang khai thác một biến thể của CVE-2025-49706. Lỗ hổng này đã được gán mã CVE-2025-53770."

Microsoft cho biết rằng lỗ hổng này không ảnh hưởng đến Microsoft 365 và đang làm việc để phát hành một bản cập nhật bảo mật, sẽ được phát hành càng sớm càng tốt.

Để giảm thiểu lỗ hổng, Microsoft khuyến nghị rằng khách hàng kích hoạt [tính năng tích hợp AMSI](https://learn.microsoft.com/en-us/sharepoint/security-for-sharepoint-server/configure-amsi-integration) trong SharePoint và triển khai Defender AV trên tất cả các máy chủ SharePoint.

AMSI của Microsoft (Antimalware Scan Interface) là một tính năng bảo mật cho phép các ứng dụng và dịch vụ truyền nội dung có khả năng độc hại đến một giải pháp antivirus đã được cài đặt để quét thời gian thực. Nó thường được sử dụng để kiểm tra các kịch bản và mã trong bộ nhớ, giúp phát hiện và chặn các mối đe dọa mờ ám hoặc động.

Microsoft cho biết rằng việc kích hoạt các biện pháp giảm thiểu này sẽ ngăn chặn các cuộc tấn công không xác thực khai thác lỗ hổng này.

Công ty lưu ý rằng tính năng này đã được bật theo mặc định kể từ các bản cập nhật bảo mật tháng 9 năm 2023 cho SharePoint Server 2016/2019 và bản cập nhật tính năng Version 23H2 cho SharePoint Server Subscription Edition.

Nếu bạn không thể kích hoạt AMSI, Microsoft cho biết rằng các máy chủ SharePoint nên được ngắt kết nối khỏi internet cho đến khi có bản cập nhật bảo mật được phát hành.

Để kiểm tra xem một máy chủ SharePoint đã bị xâm phạm hay chưa, quản trị viên có thể kiểm tra xem tệp `C:\PROGRA~1\COMMON~1\MICROS~1\WEBSER~1\16\TEMPLATE\LAYOUTS\spinstall0.aspx` có tồn tại hay không.

Microsoft cũng đã chia sẻ truy vấn Microsoft 365 Defender dưới đây có thể được sử dụng để kiểm tra tệp này:

```
eviceFileEvents
| where FolderPath has "MICROS~1\\WEBSER~1\\16\\TEMPLATE\\LAYOUTS"
| where FileName =~ "spinstall0.aspx"
or FileName has "spinstall0"
| project Timestamp, DeviceName, InitiatingProcessFileName, InitiatingProcessCommandLine, FileName, FolderPath, ReportId, ActionType, SHA256
| order by Timestamp desc
```

## Bị khai thác trong các cuộc tấn công RCE

Các cuộc tấn công zero-day trên Microsoft SharePoint đã [được nhận diện lần đầu tiên](https://research.eye.security/sharepoint-under-siege/) bởi công ty bảo mật mạng Hà Lan Eye Security, công ty này cho biết rằng hơn 75 công ty đã bị xâm phạm bởi các cuộc tấn công.

Eye Security lần đầu tiên quan sát các cuộc tấn công vào ngày 18 tháng 7 sau khi nhận được thông báo từ một trong những agent EDR của khách hàng rằng một quá trình nghi ngờ liên quan đến một tệp .aspx độc hại được tải lên đã được khởi chạy.

Nhật ký IIS cho thấy một yêu cầu POST đã được thực hiện tới `_layouts/15/ToolPane.aspx` với một referer HTTP là /\_layouts/SignOut.aspx.

Sau khi điều tra, các tác nhân đe dọa đã khai thác lỗ hổng ToolShell của Pwn2Own ngay sau khi CODE WHITE GmbH tái hiện việc khai thác và Soroush Dalili [đã chia sẻ thêm thông tin kỹ thuật](https://x.com/irsdl/status/1946166765316161634) về referer web vào tuần trước.

"Chúng tôi đã tái tạo 'ToolShell', chuỗi khai thác không xác thực cho CVE-2025-49706 + CVE-2025-49704 được sử dụng bởi @\_l0gg để tấn công SharePoint tại #Pwn2Own Berlin 2025, thực sự chỉ là một yêu cầu!," [đã đăng CODE WHITE GmbH lên X](https://x.com/codewhitesec/status/1944743478350557232). 

![Demonstration of the created Microsoft SharePoint ToolShell exploit](https://www.bleepstatic.com/images/news/security/vulnerabilities/t/toolshell/toolshell-exploit.jpg)

**Hình minh họa về việc khai thác ToolShell của Microsoft SharePoint**  
_Nguồn: CODE WHITE GmbH_

Như một phần của việc khai thác, các kẻ tấn công tải lên một tệp có tên "spinstall0.aspx," được sử dụng để đánh cắp cấu hình MachineKey của máy chủ Microsoft SharePoint, bao gồm ValidationKey và DecryptionKey.

"Bây giờ, với chuỗi ToolShell (CVE-2025-49706 + CVE-2025-49704), các kẻ tấn công dường như đã trích xuất ValidationKey trực tiếp từ bộ nhớ hoặc cấu hình," Eye Security giải thích.

"Khi vật liệu mã hóa này bị rò rỉ, kẻ tấn công có thể tạo ra các payload __VIEWSTATE hợp lệ và được ký bằng một công cụ gọi là ysoserial như trong ví dụ dưới đây."

"Sử dụng ysoserial, kẻ tấn công có thể tạo ra các mã thông báo SharePoint hợp lệ của riêng mình để thực hiện RCE."

![Malicious spinstall0.aspx used to steal ValidationKey](https://www.bleepstatic.com/images/news/security/vulnerabilities/t/toolshell/spinstall-script.jpg)

**Tệp spinstall0.aspx độc hại được sử dụng để đánh cắp ValidationKey**  
_Nguồn: BleepingComputer_

ViewState được sử dụng bởi ASP.NET, nền tảng hỗ trợ SharePoint, để duy trì trạng thái của các điều khiển web giữa các yêu cầu web. Tuy nhiên, nếu không được bảo vệ đầy đủ hoặc nếu ValidationKey của máy chủ bị lộ, ViewState có thể bị can thiệp để tiêm mã độc mà thực thi trên máy chủ khi giải mã.

Giám đốc công nghệ của Eye Security, Piet Kerkhofs, đã nói với BleepingComputer rằng họ đã tiến hành quét internet để tìm kiếm các máy chủ bị xâm phạm và phát hiện hơn 75 tổ chức bị ảnh hưởng trong các cuộc tấn công.

"Mặc dù chúng tôi xác định được hơn 85 máy chủ SharePoint bị xâm phạm trên toàn cầu, nhưng chúng tôi đã có thể phân loại chúng thành các tổ chức bị ảnh hưởng," Kerkhofs nói với BleepingComputer.

"Khi phân loại, chúng tôi có thể xác nhận 29 tổ chức đã trở thành nạn nhân. Trong số 29 tổ chức đó, có một số công ty đa quốc gia và các cơ quan chính phủ quốc gia."

Kerkhofs cũng đã nói với BleepingComputer rằng một số nhà cung cấp tường lửa đang chặn thành công các payload CVE-2025-49704 đính kèm vào các yêu cầu POST HTTP. Tuy nhiên, Kerkhofs cảnh báo rằng nếu các kẻ tấn công có thể vượt qua chữ ký, nhiều máy chủ SharePoint sẽ có khả năng bị tấn công hơn.

Các IOC sau đây đã được chia sẻ để giúp các nhà bảo vệ xác định xem máy chủ SharePoint của họ có bị xâm phạm không:

* Khai thác từ địa chỉ IP `107.191.58[.]76` được Eye Security phát hiện vào ngày 18 tháng 7
* Khai thác từ địa chỉ IP `104.238.159[.]149` được Eye Security phát hiện vào ngày 19 tháng 7.
* Khai thác từ địa chỉ IP `96.9.125[.]147` [được thấy](http://github.com/PaloAltoNetworks/Unit42-timely-threat-intel/blob/main/2025-07-19-Microsoft-SharePoint-vulnerabilities-CVE-2025-49704-and-49706.txt) bởi Palo Alto Networks.
* Tạo tệp `C:\PROGRA~1\COMMON~1\MICROS~1\WEBSER~1\16\TEMPLATE\LAYOUTS\spinstall0.aspx`.
* Nhật ký IIS cho thấy một yêu cầu POST tới `_layouts/15/ToolPane.aspx?DisplayMode=Edit&a=/ToolPane.aspx` và một referer HTTP là `_layouts/SignOut.aspx`.

Nếu phát hiện bất kỳ IOC nào trong nhật ký IIS hoặc hệ thống tệp, các quản trị viên nên giả định rằng máy chủ của họ đã bị xâm phạm và ngay lập tức ngắt kết nối nó.

Các cuộc điều tra thêm nên được thực hiện để xác định xem các tác nhân đe dọa đã lan rộng hơn nữa đến các thiết bị khác hay không.

_Câu chuyện này đang phát triển và sẽ được cập nhật khi có thông tin mới._